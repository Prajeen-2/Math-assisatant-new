<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>SS Math Assistant — Fibonacci Spiral</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--card:#e2f7f7;--bg:#2aa399;--accent:#7c3aed;--muted:#667085}
    body{font-family:Inter,Segoe UI,Arial; background:var(--bg); margin:0; padding:24px; color:#0f172a}
    .wrap{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:360px 1fr;gap:18px}
    .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 20px rgba(15,23,42,0.06)}
    h1{margin:0 0 12px 0;font-size:20px}
    label{display:block;margin-top:10px;color:var(--muted);font-size:13px}
    input[type="number"], input[type="text"]{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef8;margin-top:8px}
    .btn{display:inline-block;margin-top:10px;padding:8px 12px;border-radius:8px;border:none;background:var(--accent);color:white;cursor:pointer}
    #resultBox{margin-top:10px;padding:10px;border-radius:8px;background:#f8fafc;border:1px solid #e6eef8;font-weight:600}
    canvas{width:100%;height:720px;display:block;border-radius:12px;background:white}
  </style>
</head>
<body>
  <div style="max-width:1100px;margin:0 auto;">
    <h1>SS Math Assistant — Fibonacci Spiral + Calculator</h1>
    <div class="wrap">
      <div class="card">
        <h2>Calculator</h2>
        <label>Value A</label>
        <input id="valA" type="text" value="2">
        <label>Value B</label>
        <input id="valB" type="text" value="54">
        <button class="btn" onclick="doCalc('add')">Add</button>
        <button class="btn" onclick="doCalc('sub')">Subtract</button>
        <button class="btn" onclick="doCalc('mul')">Multiply</button>
        <button class="btn" onclick="doCalc('div')">Divide</button>
        <div id="resultBox" style="display:none"></div>

        <h2 style="margin-top:18px">Fibonacci Curve</h2>
        <label>Number of arcs (N)</label>
        <input id="terms" type="number" min="1" max="30" value="8">
        <button class="btn" onclick="generate()">Generate Fibonacci</button>
      </div>

      <div class="card" style="padding:12px">
        <canvas id="canvas" width="1000" height="720"></canvas>
      </div>
    </div>
  </div>

<script>
const API = "http://localhost:8080";
function qs(s){return document.querySelector(s);}

/* ---------------- CALCULATOR ---------------- */
function doCalc(op){
  const body = `a=${qs("#valA").value}&b=${qs("#valB").value}&op=${op}`;
  qs("#resultBox").style.display = "block";
  qs("#resultBox").innerText = "Calculating...";

  fetch(API + "/api/calculate",{
    method:"POST",
    headers:{"Content-Type":"application/x-www-form-urlencoded"},
    body
  })
  .then(r=>r.json())
  .then(j=>qs("#resultBox").innerText="Result: "+j.result)
  .catch(()=>qs("#resultBox").innerText="Network error");
}

/* ---------------- FIBONACCI ---------------- */
let fibData=null;
const canvas=qs("#canvas"), ctx=canvas.getContext("2d");
let scale=50, offsetX=canvas.width/2, offsetY=canvas.height/2;

function generate(){
  const terms=qs("#terms").value;
  qs("#resultBox").style.display="block";
  qs("#resultBox").innerText="Generating...";

  fetch(API+"/api/fibonacci",{
    method:"POST",
    headers:{"Content-Type":"application/x-www-form-urlencoded"},
    body:"terms="+terms
  })
  .then(r=>r.json())
  .then(json=>{
    fibData=json;
    drawGraph(json);
    qs("#resultBox").innerText="Generated.";
  })
  .catch(()=>qs("#resultBox").innerText="Network error");
}

/* -------------- DRAW GRAPH + AXIS ---------------- */
function worldToScreen(x,y){
  return {x:x*scale+offsetX, y:-y*scale+offsetY};
}

function drawAxis(){
  ctx.strokeStyle="#222";
  ctx.lineWidth=2;

  // X-axis
  ctx.beginPath();
  ctx.moveTo(0,offsetY);
  ctx.lineTo(canvas.width,offsetY);
  ctx.stroke();

  // Y-axis
  ctx.beginPath();
  ctx.moveTo(offsetX,0);
  ctx.lineTo(offsetX,canvas.height);
  ctx.stroke();

  // Grid + labels
  ctx.font="12px Arial";
  ctx.fillStyle="#555";
  ctx.strokeStyle="#ddd";
  ctx.lineWidth=1;

  for(let i=-20;i<=20;i++){
    // vertical grid lines
    let p1=worldToScreen(i,20);
    let p2=worldToScreen(i,-20);
    ctx.beginPath();
    ctx.moveTo(p1.x,p1.y);
    ctx.lineTo(p2.x,p2.y);
    ctx.stroke();

    // label on X-axis
    let lbl=worldToScreen(i,0);
    ctx.fillText(i,lbl.x-3,lbl.y+12);
  }

  for(let j=-20;j<=20;j++){
    let p1=worldToScreen(-20,j);
    let p2=worldToScreen(20,j);
    ctx.beginPath();
    ctx.moveTo(p1.x,p1.y);
    ctx.lineTo(p2.x,p2.y);
    ctx.stroke();

    let lbl=worldToScreen(0,j);
    ctx.fillText(j,lbl.x+6,lbl.y+4);
  }
}

/* -------------- DRAW SPIRAL ---------------- */
function drawGraph(data){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawAxis();

  ctx.strokeStyle="#ff6600";
  ctx.lineWidth=3;

  data.arcs.forEach(a=>{
    const c=worldToScreen(a.cx,a.cy);
    const r=a.r*scale;
    const start=-a.start;
    const end=-(a.start+Math.PI/2);
    ctx.beginPath();
    ctx.arc(c.x,c.y,r,start,end);
    ctx.stroke();
  });
}

window.onload=generate;
</script>
</body>
</html>
